 /*
    Based on Neil Kolban example for IDF: https://github.com/nkolban/esp32-snippets/blob/master/cpp_utils/tests/BLE%20Tests/SampleServer.cpp
    Ported to Arduino ESP32 by Evandro Copercini
    updates by chegewara
*/

#include <BLEDevice.h>
//#include <BLEUtils.h>
#include <BLEServer.h>
#include <BLE2902.h>
#include <string>

#define TRANSMISSION_SIZE 500

// See the following for generating UUIDs:
// https://www.uuidgenerator.net/
#define  TEST_SERVICE_UUID  "f9fd0005-71ae-42c4-bd19-9d5e37ebf073"
#define  TEST_CHAR_1        "f9fd0006-71ae-42c4-bd19-9d5e37ebf073"
#define  TEST_CHAR_2        "f9fd0016-71ae-42c4-bd19-9d5e37ebf073"
#define  TEST_CHAR_3        "f9fd0017-71ae-42c4-bd19-9d5e37ebf073"

String payloadName = "MVPayload_Nest";

///// PICTURE BIT MAP //////////////
size_t iLen = 10800;
const int iLen_int = 10800 ;
uint8_t image[iLen_int] = {249,249,249,249,249,241,249,241,249,232,157,70,52,45,52,38,57,118,201,249,241,241,249,249,249,249,249,249,249,249,241,125,241,249,249,249,249,249,249,249,249,249,249,241,249,135,232,241,241,249,249,241,249,241,249,249,241,249,241,249,241,249,241,249,241,249,241,249,241,249,241,249,249,241,123,249,241,249,249,249,249,249,249,249,249,249,249,249,249,123,241,249,249,249,249,249,249,249,249,241,249,241,241,194,139,114,104,125,164,220,241,241,249,241,249,249,249,249,249,249,249,249,249,241,249,249,241,220,118,64,162,181,169,147,125,123,123,194,114,64,183,249,249,241,249,241,249,241,249,249,241,125,249,249,241,249,241,249,241,249,241,249,249,249,249,135,232,249,249,241,249,226,201,164,125,74,54,38,30,26,26,26,30,45,60,89,136,181,213,232,249,249,241,249,123,241,249,249,241,249,241,249,241,249,241,249,241,249,249,123,249,249,241,249,241,249,241,249,241,249,206,100,66,104,125,136,156,97,73,97,64,162,232,249,249,241,249,241,249,249,249,249,249,249,249,249,183,60,183,241,249,232,132,125,89,123,123,241,249,220,114,97,232,249,249,249,249,249,249,249,249,125,241,249,249,249,249,249,249,249,249,241,249,241,249,201,241,232,181,114,40,12,3,0,0,0,0,0,5,12,12,7,5,0,0,0,0,0,3,15,57,135,197,241,220,249,241,249,249,249,249,249,249,249,249,249,249,249,249,123,241,249,249,249,249,249,249,249,232,123,80,201,249,220,139,135,74,123,123,249,232,147,64,196,241,249,249,249,249,249,249,249,241,241,241,157,73,241,249,249,241,249,118,125,162,118,139,249,241,249,241,181,64,232,249,249,249,249,249,241,241,125,249,249,249,249,249,249,249,249,249,241,249,249,241,169,66,7,0,0,0,13,54,104,156,183,213,220,206,181,173,173,183,201,201,181,136,89,38,5,0,0,0,17,100,197,241,249,241,249,249,249,249,249,249,249,249,249,249,123,249,249,249,249,249,249,241,226,64,173,249,249,249,249,125,123,104,132,123,249,249,249,226,70,169,241,241,249,249,249,249,249,249,249,173,89,249,226,197,197,241,249,118,114,118,114,169,249,213,220,249,249,191,70,241,249,249,249,249,249,249,125,249,249,249,249,249,249,249,249,249,241,206,100,15,0,0,13,66,147,206,241,249,241,249,226,169,156,156,162,147,132,135,136,157,197,241,249,249,232,194,132,45,7,0,0,35,139,226,249,249,249,249,249,249,249,249,249,249,123,241,249,249,249,249,249,232,66,196,249,249,232,249,249,123,123,139,118,162,249,241,249,249,241,97,162,241,249,249,249,249,249,249,218,64,232,226,156,164,196,249,241,125,104,97,80,197,249,241,181,206,241,249,164,123,249,241,249,249,249,241,125,249,249,249,249,241,241,241,241,196,64,5,0,7,66,173,232,249,249,249,249,249,241,197,156,132,157,125,196,226,220,173,135,132,135,156,220,249,249,249,249,249,218,139,45,3,0,13,118,218,249,241,241,249,249,249,249,249,123,249,249,249,249,241,241,74,191,249,241,201,181,249,241,136,123,100,97,201,249,218,196,181,232,241,74,197,249,249,249,249,249,249,73,201,249,206,164,169,241,232,226,156,89,139,70,226,241,249,249,194,206,241,249,70,201,249,249,249,241,249,123,249,249,249,249,241,249,213,66,0,0,15,132,226,139,232,249,249,249,249,249,241,157,132,60,89,206,241,249,139,157,173,135,147,104,118,132,220,241,249,249,249,241,123,249,201,80,5,0,7,125,232,241,249,249,249,249,249,123,241,249,249,241,249,173,125,241,249,197,196,249,241,249,156,118,136,74,241,249,249,139,136,156,249,220,64,241,249,249,249,249,201,80,249,249,191,197,241,213,125,183,191,66,89,73,249,196,183,249,249,173,241,241,213,89,249,249,249,249,241,125,249,249,241,249,226,118,5,0,26,147,241,249,249,135,232,249,249,249,249,241,206,97,89,181,226,232,181,97,169,181,226,249,241,157,104,104,139,249,249,249,241,249,123,249,249,249,213,100,12,0,24,164,241,249,249,249,249,123,249,249,249,249,241,60,241,249,218,191,249,241,183,218,183,73,114,80,249,191,191,241,169,157,249,241,139,173,249,241,249,241,118,201,249,249,232,249,226,139,181,196,213,57,66,89,241,249,213,194,241,241,241,241,249,70,226,249,249,249,249,125,249,241,249,181,26,0,13,135,226,249,241,249,249,136,232,249,249,249,249,241,135,125,135,181,201,162,135,136,232,249,213,156,118,66,100,114,114,197,249,249,249,241,123,249,241,249,249,249,206,73,3,0,60,218,241,249,249,123,241,249,249,249,183,132,249,249,220,241,249,181,220,249,201,54,80,89,249,139,146,181,249,218,241,249,226,60,249,249,249,241,57,241,249,241,249,249,206,201,191,249,183,64,89,70,232,249,241,197,249,241,249,241,249,146,181,249,249,241,241,125,249,241,104,0,0,66,220,249,249,249,249,249,249,135,241,249,249,249,241,222,66,45,57,191,220,132,125,241,249,173,45,47,74,123,118,104,104,162,249,241,249,249,123,241,249,249,241,249,249,249,191,26,0,13,169,249,241,125,249,249,249,249,104,206,249,249,249,249,226,213,249,249,213,30,70,73,241,218,147,157,249,241,249,241,249,70,220,249,249,220,57,135,123,123,139,173,197,218,226,173,97,80,80,97,114,226,241,249,241,249,241,249,249,197,123,241,249,249,249,169,213,45,0,15,169,241,249,249,249,249,249,249,249,135,232,249,249,244,244,157,173,173,181,213,181,100,191,213,118,54,104,156,156,132,114,100,104,118,232,249,249,241,123,249,249,249,249,249,249,241,249,232,104,3,3,104,241,191,241,249,249,249,57,125,123,156,183,213,226,241,249,201,97,100,100,89,139,249,232,241,241,249,241,249,249,146,181,249,249,213,60,135,123,118,118,100,74,60,57,64,100,173,196,135,89,74,100,114,118,123,125,135,135,125,89,249,241,249,241,191,17,0,52,213,249,249,249,249,249,249,249,249,249,135,232,249,249,249,244,144,74,74,156,218,173,100,201,89,30,162,147,73,147,100,100,73,73,104,226,249,249,249,123,241,249,249,249,249,249,249,241,249,241,181,13,0,54,220,249,241,249,249,45,123,125,123,104,89,74,73,74,74,97,162,197,125,97,114,146,147,156,157,162,164,164,132,146,249,249,201,114,64,60,162,104,114,164,123,97,74,139,164,156,157,73,97,114,97,123,80,80,73,60,74,73,249,249,249,173,7,0,100,241,249,249,249,249,249,249,249,249,249,249,135,241,249,249,244,236,123,181,98,213,206,156,30,114,181,157,73,5,13,196,181,194,66,70,114,206,249,249,241,123,249,249,249,249,249,249,249,249,249,249,249,220,38,0,26,218,249,249,241,73,100,66,156,114,89,136,74,73,74,132,146,156,139,89,64,57,54,73,64,89,73,73,104,139,249,249,213,57,123,118,123,114,97,70,66,60,66,100,164,194,132,89,80,104,97,89,89,100,97,100,97,80,249,241,156,3,5,139,249,249,241,249,249,249,249,249,249,249,249,241,135,232,249,249,244,225,103,47,98,164,220,218,136,125,169,173,26,3,13,162,201,100,64,64,97,194,249,249,249,123,241,249,249,249,249,249,249,249,249,249,249,249,232,66,0,24,201,249,241,57,147,132,123,118,104,97,73,60,66,104,156,173,136,104,89,123,104,104,97,89,80,89,66,146,249,249,226,52,132,123,132,157,191,213,226,241,181,97,80,74,97,118,213,220,226,241,241,249,241,249,196,123,249,157,3,5,164,249,241,249,241,249,249,249,249,241,249,249,249,249,135,232,249,244,249,244,80,183,169,70,191,206,226,147,123,64,74,12,26,191,206,64,57,64,97,194,249,241,241,123,249,249,249,249,249,249,249,249,249,249,249,249,249,241,89,0,24,201,249,57,139,132,123,125,156,181,201,218,164,89,89,118,89,100,183,197,213,218,220,226,226,232,157,164,249,249,241,60,241,249,241,249,249,206,249,241,241,146,89,89,89,232,241,147,164,241,249,241,249,241,146,181,169,3,5,181,100,191,213,123,123,123,123,123,123,123,123,123,123,123,57,118,123,226,249,241,133,197,67,104,118,211,206,218,197,147,146,57,13,97,73,15,70,70,100,197,249,181,123,52,123,123,123,123,123,123,123,123,123,123,123,123,156,226,136,97,0,24,220,74,206,249,249,241,249,226,201,196,249,139,89,66,80,226,249,249,220,249,249,249,249,249,100,206,249,249,249,118,197,241,249,220,249,232,169,241,249,181,104,80,146,241,146,135,173,241,241,232,241,249,66,181,5,5,164,249,213,47,196,241,241,241,249,241,249,249,241,249,241,241,135,232,249,243,249,244,229,143,190,136,33,83,123,162,157,135,100,132,7,64,26,26,57,80,104,220,249,241,241,123,241,241,249,249,249,249,249,249,249,249,241,249,226,54,181,249,80,0,35,147,164,249,249,232,249,232,156,139,196,183,136,97,136,241,249,218,183,249,241,249,249,241,54,241,249,249,249,201,80,249,249,181,226,249,226,169,241,197,97,80,146,241,181,173,249,183,181,241,249,206,66,17,0,146,249,249,132,220,45,194,249,249,249,249,249,249,249,249,249,249,135,232,249,249,249,249,249,216,205,54,124,47,30,136,97,104,89,125,24,70,136,64,73,135,169,249,249,249,249,123,249,249,249,249,249,249,249,249,249,241,249,220,52,173,157,241,241,60,0,54,66,241,249,191,206,232,218,146,181,197,118,74,139,249,201,183,249,249,173,249,241,181,132,249,249,249,249,249,74,197,241,249,169,232,249,241,249,220,80,114,147,249,249,241,191,146,135,241,241,66,24,0,104,241,249,241,125,249,220,45,197,249,249,249,249,249,249,249,249,249,136,232,249,249,249,243,249,244,216,115,132,35,123,173,147,191,157,201,30,157,173,206,147,181,232,249,241,241,249,118,249,249,249,249,249,249,249,249,249,249,226,52,181,249,123,249,241,232,26,0,15,183,249,218,181,169,232,249,213,206,89,100,146,249,218,249,249,194,206,249,241,64,232,249,249,249,249,249,220,64,232,249,241,169,218,249,241,232,70,89,147,249,249,241,183,146,220,241,157,12,0,54,241,249,249,241,125,249,249,206,47,206,249,249,249,249,249,249,249,249,135,241,249,249,249,249,242,249,225,164,74,70,88,135,118,197,211,213,66,162,191,197,191,232,249,249,249,249,249,123,249,249,249,249,249,249,241,249,241,226,57,173,249,249,123,249,249,249,213,13,0,24,226,241,162,139,197,241,249,220,74,74,156,249,249,241,183,197,249,249,139,147,249,249,249,249,249,249,249,181,80,241,241,249,213,249,249,241,70,89,146,249,249,201,226,226,249,191,26,0,15,213,241,249,249,249,125,249,249,249,206,45,201,249,249,249,249,249,249,249,135,232,249,249,249,249,249,249,249,181,169,135,151,136,118,191,206,206,132,173,201,197,201,226,249,249,249,249,241,123,241,249,249,249,249,249,249,241,226,52,173,249,249,249,123,241,249,249,249,162,3,0,60,232,241,197,194,241,249,232,66,70,156,249,249,206,220,249,249,181,89,241,249,249,249,249,249,249,241,249,169,70,232,249,241,249,241,241,74,104,146,249,241,249,249,241,173,60,15,0,173,249,249,241,249,241,125,249,241,249,249,206,45,213,249,249,249,249,249,249,135,234,249,249,249,249,249,249,242,249,243,226,181,169,147,181,162,162,115,164,181,183,183,241,249,249,249,249,249,123,249,249,249,249,241,249,241,232,52,181,249,249,249,249,123,249,249,249,249,241,73,0,38,66,232,249,249,249,249,241,60,97,162,249,249,249,249,241,164,70,241,249,241,249,249,249,249,249,249,249,249,191,60,181,241,249,241,249,73,80,147,249,241,249,218,100,104,100,0,70,249,241,249,249,249,249,123,249,249,249,249,249,197,47,218,249,249,249,249,249,136,232,249,249,249,249,249,249,242,249,241,249,232,213,206,201,213,201,173,220,218,197,220,241,241,249,249,249,249,118,249,249,249,249,249,249,232,57,173,249,249,249,249,249,123,241,249,249,249,241,226,13,3,147,57,173,241,241,241,241,60,70,169,241,249,249,218,97,123,241,249,249,249,249,249,249,249,249,249,249,241,241,226,123,64,147,218,241,74,104,156,232,191,97,70,191,206,7,13,226,249,249,249,249,249,241,125,249,249,249,249,249,241,196,45,218,249,249,249,249,135,235,249,249,249,249,249,249,220,169,97,40,15,17,17,24,23,15,24,54,123,181,241,241,249,249,249,249,249,123,249,249,249,249,241,226,54,173,249,249,249,249,249,249,123,249,249,249,249,241,249,164,0,40,232,135,64,147,218,241,60,89,164,241,183,100,70,194,249,241,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,169,80,57,35,40,45,60,132,213,249,249,64,0,136,249,249,249,249,249,249,241,125,249,249,249,249,249,249,249,196,47,220,242,249,249,136,232,249,249,242,242,181,60,12,54,135,194,164,132,139,146,146,146,162,173,114,35,13,100,206,249,241,249,241,123,241,249,241,249,226,54,181,249,249,249,249,249,249,249,123,241,249,249,249,249,249,241,52,0,157,249,241,173,80,60,26,40,47,64,135,213,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,241,249,249,241,249,241,249,241,249,241,194,0,26,232,249,249,249,249,249,249,241,125,249,249,249,249,249,249,249,241,183,54,226,249,249,135,235,249,241,169,38,36,151,226,242,242,249,173,132,136,125,146,151,181,249,241,249,206,118,17,66,201,249,241,123,249,249,249,226,60,169,249,249,249,249,249,249,249,249,123,249,249,249,249,249,249,249,191,3,24,241,241,249,241,249,241,249,249,241,249,241,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,241,249,249,241,249,249,249,241,60,0,156,249,249,249,249,249,249,249,241,125,241,249,249,249,249,249,249,249,249,181,47,226,242,136,232,213,54,36,181,243,249,249,249,249,249,173,125,135,123,146,139,191,241,249,249,249,249,232,136,17,118,232,136,249,241,226,54,173,249,241,249,249,249,249,249,241,249,123,241,249,249,249,249,249,241,241,60,0,156,241,249,241,249,249,249,241,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,201,3,17,249,241,249,249,249,249,249,241,249,139,249,241,249,249,249,249,249,249,249,249,183,54,232,181,164,13,98,195,242,249,249,249,249,241,249,173,135,123,118,139,132,213,249,249,249,249,249,249,249,220,66,35,213,241,232,54,181,249,249,249,249,249,249,249,241,249,241,123,249,241,249,249,249,249,249,241,194,0,30,241,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,97,0,139,241,249,249,249,249,241,249,191,183,181,162,249,249,249,249,249,249,249,249,242,249,169,156,125,23,151,183,183,220,249,249,249,249,249,249,174,133,123,132,135,123,241,244,249,249,249,249,249,249,249,241,146,24,183,114,169,241,249,249,249,249,249,249,249,249,249,213,194,191,249,249,249,249,249,249,249,249,40,3,181,249,241,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,241,241,241,241,232,13,12,232,249,241,249,249,249,241,249,183,135,132,100,249,249,249,249,249,249,249,249,241,249,241,104,30,169,183,183,183,191,241,242,249,249,249,249,191,133,118,114,132,118,249,249,249,249,241,241,241,249,241,249,241,181,15,173,249,241,249,249,249,249,249,249,249,241,241,164,80,100,249,241,249,249,249,249,249,241,164,0,66,249,249,241,241,249,249,241,249,241,249,241,249,249,249,249,241,249,241,249,206,123,123,123,123,123,123,123,123,123,123,123,123,123,123,100,132,162,0,73,206,123,123,123,123,123,123,169,194,181,157,181,183,123,118,123,123,123,118,123,123,183,123,30,181,183,183,183,183,181,192,242,249,249,249,249,213,123,118,104,123,123,249,241,249,249,249,241,157,206,241,241,241,249,194,15,191,146,123,123,123,123,123,123,123,123,162,194,173,157,232,125,118,123,123,123,123,146,241,15,12,232,132,89,123,123,123,123,123,123,123,123,123,123,123,123,123,194,249,249,249,249,241,249,241,249,241,249,241,249,241,249,241,249,241,147,249,57,0,183,249,249,249,249,249,249,249,249,249,232,139,249,249,249,249,249,241,249,249,249,242,162,24,173,183,183,183,183,165,104,104,226,242,249,249,249,232,114,114,104,115,132,244,249,249,249,249,249,241,139,194,132,249,249,249,173,26,218,241,241,241,249,241,249,241,249,249,181,7,57,249,249,249,249,241,249,241,249,241,80,0,157,249,123,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,241,156,226,5,15,232,241,249,249,249,249,249,249,249,249,232,164,249,241,249,249,249,249,249,249,249,206,13,156,183,183,183,183,160,99,91,91,160,242,241,249,249,249,104,107,118,104,139,242,249,249,249,249,249,249,213,139,100,156,241,241,241,132,52,241,249,249,249,249,249,249,249,249,183,13,60,249,249,249,249,249,249,249,249,249,191,0,57,249,118,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,241,156,173,0,73,249,249,249,249,249,249,249,249,241,249,232,191,241,249,249,249,249,249,249,249,241,52,100,183,183,183,183,157,92,91,91,92,99,212,244,249,249,249,104,104,97,100,147,249,249,249,242,201,249,249,241,162,136,97,206,249,249,241,45,139,249,241,249,249,249,249,249,241,249,201,220,249,249,249,249,249,249,249,249,241,232,13,7,232,123,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,241,147,97,0,162,249,241,249,249,249,249,249,249,249,249,232,139,241,249,249,249,249,249,249,241,164,40,213,191,183,183,168,99,92,92,91,91,68,76,244,249,249,249,115,88,89,97,157,241,249,249,249,183,125,232,249,249,139,147,196,241,249,249,201,24,218,249,249,249,249,249,249,249,232,13,114,249,249,249,249,249,249,249,249,249,249,64,0,183,123,241,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,241,156,30,0,218,249,249,249,249,249,249,249,249,249,241,241,196,249,241,249,249,249,249,249,241,35,181,249,241,197,181,108,88,91,92,91,55,32,32,164,249,249,249,125,73,100,80,158,249,249,249,249,249,213,114,226,249,249,241,118,241,241,249,249,89,114,249,249,249,249,249,249,249,241,64,147,249,249,249,249,249,249,249,249,249,249,139,0,125,123,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,241,136,12,17,241,249,249,249,249,249,249,249,249,241,249,226,156,241,249,249,249,249,249,249,169,45,241,249,244,249,215,128,92,88,91,56,32,32,32,41,226,244,249,136,66,74,74,173,249,241,220,249,241,249,226,118,241,249,249,220,232,249,249,249,213,17,232,249,249,249,249,249,249,241,118,191,249,249,249,249,249,249,249,249,249,249,196,0,54,123,241,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,232,114,0,66,249,249,249,249,249,249,249,249,249,249,241,226,146,241,249,249,249,249,249,249,54,162,249,249,249,243,249,236,178,103,68,32,32,32,32,31,108,249,244,147,64,73,66,196,249,241,157,80,147,241,241,196,147,249,249,249,249,241,249,249,249,64,147,249,249,249,249,249,249,249,26,157,249,249,249,249,249,249,249,249,249,249,232,3,17,146,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,241,123,0,123,249,249,249,249,249,249,249,249,249,249,249,241,213,241,249,249,249,249,249,218,12,226,249,241,249,249,249,249,244,224,91,32,32,32,31,9,5,196,249,157,64,58,60,206,249,249,201,60,114,114,249,249,201,249,249,241,249,249,249,249,249,173,47,249,241,249,249,249,249,249,194,220,249,249,249,249,249,249,249,249,249,249,249,26,7,218,241,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,241,104,0,164,249,249,249,249,249,249,249,249,249,249,241,232,146,241,249,249,249,249,249,157,64,249,249,249,249,249,249,249,249,244,244,178,44,31,9,0,0,47,241,157,44,33,44,213,249,241,249,173,89,196,249,249,249,249,249,249,249,249,249,249,249,232,7,220,249,249,249,249,249,249,64,197,249,249,249,249,249,249,249,249,249,249,249,64,0,197,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,66,0,196,241,249,249,249,249,249,249,249,249,249,249,252,164,249,241,249,249,241,249,74,146,249,249,249,249,249,249,249,249,244,249,249,230,108,5,0,0,0,97,78,100,102,97,83,139,241,241,249,220,201,249,249,249,249,249,249,249,249,249,249,241,249,47,181,241,249,249,249,249,249,45,194,249,249,249,249,249,249,249,249,249,249,249,104,0,164,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,45,0,226,249,249,249,249,249,249,249,249,249,241,249,252,217,249,249,249,249,249,241,35,64,162,213,241,241,241,243,242,249,242,249,249,249,249,193,36,0,60,89,89,82,98,74,97,97,125,241,241,249,249,249,249,249,249,249,241,249,249,249,249,241,249,114,125,249,249,249,249,249,249,196,241,249,249,249,249,249,249,249,249,249,249,249,136,0,139,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,30,5,249,249,249,249,249,249,249,249,249,249,249,242,252,158,249,242,249,249,249,232,13,146,135,89,66,97,147,201,241,243,242,249,249,249,249,249,249,74,89,97,82,104,70,115,89,80,89,162,249,249,249,249,249,249,241,249,241,249,232,218,196,181,173,114,70,241,249,249,249,249,249,54,218,249,249,249,249,249,249,249,249,249,249,249,157,0,118,241,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,241,249,24,13,241,249,241,249,241,249,241,249,241,249,249,244,244,192,242,249,249,244,249,220,15,146,125,114,100,104,97,80,74,89,97,114,127,146,162,173,162,80,89,89,100,181,206,156,89,100,89,100,206,196,181,168,156,147,139,132,125,123,123,125,136,147,146,114,45,249,249,249,249,241,249,74,220,249,249,249,249,249,249,249,249,249,249,241,173,0,100,249,249,241,249,241,249,241,249,241,249,241,249,241,249,249,249,249,249,249,249,249,249,249,249,249,249,249,241,249,249,249,17,13,249,241,249,249,249,249,249,249,249,249,249,242,241,203,249,241,249,249,249,213,24,146,123,100,89,100,104,114,100,74,67,66,64,66,70,73,47,104,89,97,158,102,163,135,136,80,80,73,52,58,72,88,104,100,100,104,118,125,135,136,139,139,139,125,35,249,249,241,249,249,249,173,249,241,249,241,249,241,249,241,249,241,249,249,183,0,89,241,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,218,157,157,157,157,157,157,157,157,157,162,157,162,164,249,15,15,249,206,157,157,157,157,157,157,157,157,157,190,232,175,222,158,157,157,162,191,12,132,45,40,40,147,97,89,97,140,97,80,115,89,78,73,52,100,104,57,215,104,80,104,162,123,74,74,45,60,60,74,73,73,80,118,97,100,114,136,125,132,136,136,30,206,157,162,157,181,249,100,241,181,157,157,162,157,162,157,162,157,157,218,191,0,80,226,157,157,157,157,157,157,157,157,157,157,157,157,201,249,249,241,213,218,213,218,213,218,213,218,213,213,213,213,213,249,17,13,249,232,213,213,215,215,215,215,215,215,215,220,244,206,252,213,215,213,213,206,17,135,104,80,89,100,107,104,97,74,70,70,66,70,73,74,54,100,82,104,146,135,181,156,125,73,89,73,66,73,78,78,80,100,104,114,118,118,123,125,125,135,135,123,35,232,213,213,213,218,249,181,249,218,213,213,213,213,213,213,213,213,213,241,181,0,89,241,213,213,218,213,218,213,218,213,218,213,218,213,226,249,249,241,249,249,249,249,249,249,249,249,249,249,249,249,249,241,26,12,249,249,249,249,249,249,249,249,249,249,249,249,242,184,249,249,249,249,249,220,17,146,118,104,104,104,97,74,82,97,103,123,139,162,173,183,181,80,97,89,89,146,166,132,88,100,89,100,169,160,151,146,132,114,104,104,114,123,135,136,135,132,132,89,52,249,249,249,249,249,249,162,249,249,249,249,249,249,249,249,249,249,249,249,169,0,104,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,30,3,249,249,241,249,249,249,249,249,249,249,249,242,242,183,244,249,249,249,249,241,13,146,135,73,70,104,165,220,249,249,249,249,249,249,241,249,249,133,89,89,88,102,135,74,98,97,82,133,249,249,244,249,249,249,249,249,249,213,191,181,173,173,173,100,74,241,249,249,249,249,249,136,241,249,249,249,249,249,249,249,249,249,249,249,157,0,123,241,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,52,0,220,249,249,249,249,249,249,249,249,249,249,242,242,220,249,249,249,249,249,241,40,73,173,226,249,249,243,249,249,242,249,249,242,242,242,249,249,226,115,88,97,74,74,89,89,82,13,2,60,211,249,244,249,249,249,249,249,249,249,249,249,249,241,97,136,249,249,249,249,249,249,213,249,249,249,249,249,249,249,249,249,249,249,241,135,0,146,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,241,70,0,191,249,249,249,249,249,249,249,249,249,249,242,249,181,244,249,249,249,249,249,100,132,249,249,249,242,249,249,242,249,249,242,249,249,181,157,249,249,232,147,78,74,80,73,114,47,0,0,0,13,147,241,241,249,249,249,249,249,241,249,249,241,249,38,191,241,249,249,249,249,249,135,241,249,249,249,249,249,249,249,249,249,249,249,97,0,173,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,241,74,0,157,249,249,249,249,249,249,249,249,249,249,242,242,197,249,249,249,249,249,241,173,52,241,249,249,249,249,249,249,249,243,242,249,216,164,100,181,249,249,249,132,66,45,80,226,213,7,0,0,23,32,61,202,244,249,249,249,249,249,249,249,249,220,7,232,249,249,249,249,249,249,136,249,249,249,249,249,249,249,249,249,249,249,249,54,0,201,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,241,66,0,104,249,249,249,249,249,249,249,249,249,249,242,249,194,242,249,249,249,249,249,232,12,218,249,249,249,249,249,249,249,201,194,242,241,136,74,80,220,242,242,123,74,54,97,220,249,108,3,17,32,32,32,43,139,232,249,241,249,249,249,249,241,156,60,249,241,249,249,249,249,249,194,241,249,249,249,249,249,249,249,249,249,249,249,24,12,218,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,232,123,0,54,249,249,249,249,249,249,249,249,249,249,249,242,181,249,241,249,249,249,249,249,70,139,249,241,242,242,242,242,242,242,123,220,249,241,123,151,206,249,249,118,74,52,89,218,249,222,50,32,32,32,32,41,88,115,199,244,249,241,249,249,241,47,173,249,249,249,249,249,249,249,132,249,249,249,249,249,249,249,249,249,249,249,220,0,26,136,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,241,139,13,13,241,249,249,249,249,249,249,249,249,249,249,242,223,242,249,249,249,249,249,249,196,26,232,249,242,249,162,241,249,242,229,107,241,249,242,249,249,249,249,98,80,70,80,206,244,249,176,32,32,32,37,84,91,88,88,146,232,249,249,249,196,26,249,249,249,249,249,249,249,249,183,241,241,249,249,249,249,249,249,249,249,249,191,0,64,123,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,232,156,40,0,201,249,249,249,249,249,249,249,249,249,241,241,181,249,249,249,249,249,249,249,241,52,157,249,249,242,206,146,220,241,242,219,104,218,249,241,249,242,249,74,70,47,80,196,249,249,244,76,32,42,84,88,91,91,91,147,184,206,241,249,60,139,249,249,249,249,249,249,249,249,157,249,249,249,249,249,249,249,249,249,249,249,125,0,136,123,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,241,147,118,0,146,241,249,249,249,249,249,249,249,249,241,249,181,241,249,249,249,249,249,242,249,192,26,232,249,249,249,157,151,125,242,249,232,125,216,242,249,249,249,67,73,47,89,173,249,249,249,206,56,111,92,92,92,91,143,187,183,183,191,173,26,232,241,249,249,249,249,249,249,249,132,241,249,249,249,249,249,249,249,249,249,249,52,0,196,123,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,241,156,183,0,60,241,249,249,249,249,249,249,249,249,249,241,218,249,249,249,249,249,249,249,242,249,78,88,249,249,249,118,107,78,125,242,242,242,249,242,249,242,226,64,70,52,89,147,249,241,249,249,168,88,92,88,92,130,186,187,183,183,181,15,181,249,241,249,249,249,249,249,249,249,197,249,249,249,249,249,249,249,249,249,249,220,12,13,241,123,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,241,156,241,12,12,226,241,249,249,249,249,249,249,249,249,241,181,241,249,249,249,249,249,249,249,249,226,24,164,241,249,241,170,102,136,242,249,242,249,249,242,249,195,71,89,89,89,132,249,249,249,249,229,116,91,91,143,181,187,183,183,181,57,80,249,249,249,249,249,249,249,249,249,249,135,241,249,249,249,249,249,249,249,249,249,169,0,73,249,123,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,241,147,249,73,0,164,249,249,249,249,249,249,249,249,241,241,197,249,249,249,249,249,249,249,249,249,241,196,17,197,242,249,241,211,169,138,235,249,249,249,249,249,156,89,74,64,88,106,249,241,249,249,244,193,92,141,186,187,183,183,183,100,40,232,249,249,249,249,249,249,249,249,249,249,147,249,249,249,249,249,249,249,249,249,241,66,0,181,241,123,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,241,241,241,241,241,241,241,241,241,241,241,241,241,241,232,147,249,183,0,57,241,241,241,241,241,241,241,232,60,139,118,135,241,241,241,241,241,241,241,235,241,249,169,23,206,242,242,249,249,218,232,242,249,249,249,241,118,114,74,73,104,97,244,249,249,249,249,244,181,187,187,183,183,187,118,24,218,241,241,241,241,241,241,241,241,241,220,118,118,139,169,232,241,241,241,241,232,249,232,12,13,241,241,118,241,241,241,241,241,241,241,241,241,241,241,241,241,241,249,249,218,147,147,147,147,147,147,147,147,147,147,147,147,156,147,147,197,249,24,5,218,162,147,147,147,147,147,194,114,146,181,132,169,147,147,147,147,147,147,147,151,226,135,156,17,195,242,249,249,242,249,242,249,249,249,242,88,114,83,102,114,89,232,249,249,249,249,249,222,187,187,183,187,98,24,187,194,147,147,147,147,147,147,147,147,147,201,97,74,100,147,157,147,147,147,147,156,226,139,0,97,213,147,146,147,147,147,147,147,147,147,147,147,147,147,147,147,201,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,123,0,114,249,249,249,249,249,249,249,241,241,191,241,249,249,249,249,249,249,249,249,241,66,147,249,174,17,156,249,249,249,242,242,249,249,249,235,80,114,100,151,115,104,173,249,249,249,249,244,249,197,187,181,60,38,218,166,67,241,249,249,249,249,249,249,249,249,249,226,169,232,241,249,249,249,249,249,249,241,26,3,197,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,218,7,12,226,249,249,249,249,249,249,249,241,125,249,249,249,249,249,249,249,249,232,66,156,249,249,249,203,30,63,219,242,249,242,249,249,249,192,115,123,89,118,100,114,100,249,249,249,244,249,249,232,147,17,74,225,249,243,156,64,241,249,241,249,249,249,249,249,249,249,125,249,249,249,249,249,249,249,241,169,0,52,241,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,89,0,125,249,249,249,249,249,249,249,249,125,241,249,249,249,249,249,249,241,73,147,242,249,249,242,242,235,118,17,123,222,242,249,249,242,132,125,125,123,123,83,100,57,249,244,249,249,249,197,67,26,170,249,132,242,249,241,147,74,232,249,249,249,249,249,249,249,249,123,241,249,249,249,249,249,249,241,38,0,181,249,241,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,241,249,220,181,132,100,100,132,169,220,249,241,206,5,13,220,249,249,249,249,249,249,241,125,249,249,249,249,241,249,232,66,147,249,249,249,249,249,249,249,249,211,74,17,83,191,241,241,66,118,123,157,140,73,97,70,220,249,226,162,54,24,135,225,249,249,123,249,249,243,249,139,89,241,249,241,249,249,249,249,249,123,249,249,249,249,249,249,241,164,0,45,241,241,249,241,213,194,181,194,218,249,241,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,249,191,64,70,147,194,89,125,123,156,70,60,181,249,97,0,100,249,249,249,249,249,249,241,125,249,249,249,249,249,241,70,156,242,249,249,249,249,249,249,249,242,242,249,226,132,30,13,64,30,57,74,164,135,64,89,80,70,47,7,54,162,241,249,242,249,242,123,243,249,241,249,241,132,89,241,249,249,249,249,249,249,123,241,249,249,249,249,249,249,26,0,191,249,197,89,57,89,73,74,52,89,57,100,201,241,249,249,249,249,249,249,249,249,249,249,249,249,249,220,74,118,220,249,249,249,80,66,147,249,249,226,125,70,201,13,7,201,249,249,249,249,249,241,196,249,241,249,249,241,249,197,249,242,249,242,249,249,249,249,249,249,249,242,242,249,249,213,159,102,54,35,24,17,26,38,64,123,181,226,249,243,249,249,249,243,249,181,249,249,242,249,249,241,136,226,249,249,249,249,249,249,157,249,249,249,249,249,241,132,0,64,213,74,114,206,249,249,147,73,104,249,249,201,104,89,218,249,249,249,249,249,249,249,249,249,249,249,196,57,197,249,249,249,249,241,89,70,147,249,249,241,249,206,60,89,0,45,241,249,249,249,249,220,114,114,104,114,104,114,104,114,107,114,107,114,107,107,107,107,107,107,107,107,114,107,107,107,114,107,114,114,106,106,106,106,114,106,114,114,107,107,114,106,114,104,114,114,114,104,114,114,104,114,114,104,104,114,104,114,104,114,147,241,249,249,249,249,201,5,12,147,66,206,249,249,249,249,147,66,104,249,249,249,249,197,64,183,249,249,249,249,249,249,249,249,249,201,60,232,249,241,226,249,249,241,80,100,147,249,249,241,249,241,241,60,13,0,135,241,249,249,241,232,169,164,169,169,169,169,169,164,164,166,164,166,166,164,166,166,166,166,166,166,166,166,166,166,166,166,164,166,166,169,165,169,164,169,164,164,169,165,165,169,165,169,165,164,164,169,164,169,164,169,164,169,169,164,169,169,169,169,191,249,249,241,249,241,47,0,60,89,241,249,241,249,241,249,147,100,100,249,249,249,249,249,241,66,183,249,249,249,249,249,249,249,232,60,220,241,241,181,201,249,241,249,74,70,147,241,249,201,201,147,241,226,35,0,7,194,249,241,249,241,156,249,249,249,249,249,249,249,104,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,47,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,213,249,249,249,249,249,249,249,164,241,249,249,241,125,3,15,70,241,226,135,169,226,249,249,147,64,100,249,249,220,173,241,241,241,70,201,249,249,249,249,249,241,104,181,249,249,169,226,249,249,249,232,80,80,147,249,249,249,173,146,136,249,196,13,0,26,226,249,241,249,125,241,249,249,249,249,249,249,226,220,220,220,220,220,213,211,211,206,211,211,211,211,211,211,211,211,211,210,210,210,213,210,210,210,210,210,210,210,210,210,210,206,210,213,220,220,220,220,220,220,249,249,249,249,249,249,249,249,123,249,241,241,181,5,7,38,220,249,135,147,194,249,249,249,147,70,100,249,249,249,232,169,241,249,213,70,249,249,249,249,249,213,70,249,249,181,226,249,232,164,241,226,80,97,146,241,197,169,249,173,173,241,249,89,47,0,54,241,249,249,146,241,249,249,249,249,249,249,249,249,249,249,249,249,60,26,30,30,26,30,26,26,30,26,26,30,26,30,30,26,30,26,30,30,26,30,26,30,26,30,30,30,26,48,249,249,249,249,249,249,249,249,249,249,249,249,249,241,123,241,249,213,12,3,70,157,241,249,194,194,249,147,162,241,146,89,97,249,197,220,249,241,169,241,249,139,173,249,249,249,249,123,196,249,241,220,249,226,169,249,249,201,100,74,147,249,157,114,169,249,213,249,241,213,89,38,0,97,241,232,104,226,249,249,249,249,249,249,249,249,249,249,249,242,206,242,249,249,216,181,181,181,181,181,181,181,181,181,181,181,181,181,181,181,181,181,181,181,181,183,249,249,249,234,249,249,249,249,249,249,249,249,249,249,249,249,241,194,173,249,218,30,0,114,64,241,249,232,220,249,147,125,173,249,136,73,97,249,241,181,220,249,206,241,241,226,64,241,241,249,241,60,249,241,249,249,249,201,241,249,241,181,74,70,132,249,241,156,169,241,249,249,249,249,64,213,15,0,125,201,147,241,249,249,249,249,249,249,249,249,249,249,242,249,135,232,242,242,191,97,97,97,97,97,97,97,97,97,97,97,97,97,97,97,97,97,97,97,97,118,241,243,249,132,241,249,249,249,249,249,249,249,249,249,249,249,241,73,181,232,47,0,70,201,104,249,249,249,249,241,196,181,241,249,114,70,74,226,241,249,173,241,249,249,249,249,74,218,249,249,218,89,241,249,249,249,241,249,249,241,183,80,100,97,80,173,249,241,226,249,241,241,206,157,47,213,206,13,0,135,249,241,249,249,249,249,249,249,249,249,249,249,242,242,135,232,249,249,242,249,242,218,127,127,127,127,127,127,127,127,127,127,127,127,127,127,151,242,242,243,242,242,241,123,241,249,249,249,249,249,249,249,249,249,249,241,249,241,226,45,0,52,249,156,181,249,241,249,249,241,249,249,232,132,97,114,89,135,241,249,241,249,241,241,241,196,89,169,249,249,197,89,183,181,181,181,164,157,146,139,80,104,181,183,114,89,157,139,125,118,114,123,136,147,74,183,249,194,13,0,114,241,146,118,123,123,123,123,123,123,123,123,123,123,57,118,118,115,115,218,249,220,151,156,151,156,151,156,151,156,151,156,151,156,151,156,173,242,249,157,123,123,123,52,123,123,123,123,123,123,123,123,123,123,123,123,181,220,45,3,47,226,241,118,181,197,196,194,183,181,169,156,118,89,135,191,135,97,146,169,147,125,118,123,125,146,132,146,249,249,191,64,73,73,97,73,74,100,74,89,100,136,136,156,123,97,57,60,70,80,80,132,132,147,136,169,249,249,194,13,0,80,241,249,241,249,249,249,249,249,249,249,249,249,135,232,249,249,249,249,249,249,249,220,64,64,64,64,64,64,64,64,64,64,125,249,249,249,249,249,249,249,242,123,249,241,249,249,249,249,249,249,249,241,249,241,213,30,0,52,226,249,249,89,97,70,74,89,74,100,89,97,73,97,181,135,162,64,64,60,66,97,74,104,135,139,169,146,241,249,194,45,74,80,97,97,114,123,135,132,80,123,162,157,125,89,74,89,97,80,80,135,125,147,135,181,249,249,249,206,24,0,45,220,249,249,249,249,249,249,249,249,249,249,136,232,249,249,249,249,249,249,242,241,206,201,205,201,201,201,201,201,205,201,216,243,249,249,249,249,249,249,249,123,249,249,249,249,249,249,249,249,249,241,249,183,13,0,66,241,249,249,241,97,80,80,89,97,100,118,123,125,80,80,173,157,157,70,73,70,70,97,74,114,136,135,169,139,249,249,213,97,218,218,213,201,197,191,181,164,118,89,118,123,89,114,156,136,132,118,104,123,135,139,64,196,249,249,249,249,218,47,0,17,181,249,241,249,249,249,249,249,249,249,135,235,249,249,249,249,249,249,249,249,249,181,35,35,36,36,36,35,54,249,249,249,242,249,249,249,249,249,242,123,242,249,249,249,249,249,241,241,249,241,125,5,0,114,241,249,249,249,249,125,181,206,206,197,196,191,181,164,146,97,100,135,100,97,139,139,132,118,104,114,132,136,100,147,249,249,232,66,249,249,249,249,249,201,183,232,232,132,66,73,100,226,241,249,220,249,241,220,196,157,45,226,249,249,249,249,181,232,97,3,5,114,232,241,249,249,249,249,249,249,136,232,249,249,249,249,249,249,249,249,242,241,210,192,192,192,194,194,235,243,249,249,249,249,249,249,249,249,249,123,249,249,249,249,249,249,249,249,206,52,0,13,164,241,173,241,241,249,249,181,156,249,249,249,249,249,220,249,249,183,70,74,66,194,249,197,197,241,241,226,197,164,60,191,249,249,249,73,232,249,249,241,249,164,162,157,241,173,70,89,125,249,241,191,213,249,249,249,249,241,66,249,249,249,241,241,125,249,249,164,12,0,26,183,249,249,249,249,249,249,135,235,249,249,249,249,249,249,249,249,242,249,156,64,60,60,60,64,242,249,249,249,249,249,249,249,249,249,242,123,242,249,249,249,249,249,241,135,7,0,40,206,249,249,123,249,249,249,249,220,74,249,249,249,249,241,169,241,249,241,66,118,66,249,194,135,156,249,241,249,249,249,57,241,249,249,249,173,139,241,249,169,196,226,173,147,232,146,80,64,123,249,183,201,249,241,169,241,249,157,156,249,249,249,249,249,125,249,249,249,213,64,0,3,66,201,241,241,241,249,136,232,249,249,249,249,249,249,249,249,249,249,249,181,169,169,169,216,249,242,249,249,249,249,249,249,249,249,249,123,249,249,241,241,241,173,30,0,7,125,232,249,249,249,125,241,249,249,249,249,80,220,249,218,191,249,241,169,220,249,54,74,64,249,181,146,213,201,181,232,249,197,97,241,249,249,249,241,54,226,249,164,156,173,232,226,220,125,104,80,123,232,226,249,241,173,232,249,232,54,232,249,249,249,249,241,125,249,241,249,249,241,169,26,0,7,74,206,249,249,135,235,249,249,249,249,249,249,249,249,249,249,249,136,104,104,104,197,249,249,249,249,249,249,249,249,249,249,242,123,242,249,241,181,45,3,0,57,201,249,249,241,249,249,123,249,249,249,241,241,196,97,241,249,191,206,249,241,232,218,60,135,70,218,226,206,197,146,157,249,241,74,218,249,241,249,249,249,191,100,249,220,156,162,249,249,249,123,104,66,114,249,249,241,169,226,249,241,123,173,249,249,249,249,241,249,123,249,249,241,249,249,249,241,135,13,0,0,64,183,211,241,242,249,242,249,249,249,249,249,249,249,249,205,73,73,118,242,249,249,249,249,249,249,249,242,249,241,249,192,241,147,30,0,0,38,181,249,249,249,249,249,249,249,123,241,249,249,249,249,249,100,181,249,249,191,196,241,249,196,73,89,97,181,249,249,183,146,201,249,173,125,249,249,249,249,249,249,249,125,147,249,220,220,191,249,241,123,118,74,104,226,249,194,232,249,241,164,104,241,249,241,249,249,249,241,125,249,249,249,249,249,249,249,249,226,135,17,0,0,26,118,197,241,242,249,249,249,249,249,249,249,249,226,191,190,197,249,249,249,249,249,249,249,249,249,242,229,181,73,12,0,5,39,170,241,249,249,249,249,249,249,249,249,123,249,249,249,249,249,249,241,66,201,249,241,206,249,241,162,114,104,114,139,249,213,213,213,249,196,70,241,241,249,249,249,249,249,249,241,114,139,249,249,249,241,241,123,136,139,125,197,241,249,241,249,157,89,241,249,249,249,249,249,249,249,125,249,249,249,249,249,249,241,249,249,249,241,164,52,3,0,2,24,80,162,206,242,249,249,242,249,242,249,58,35,175,242,249,242,249,242,249,235,196,136,60,13,0,0,13,80,194,241,249,241,249,241,249,241,249,249,241,249,123,241,249,249,249,249,249,241,220,66,194,249,249,249,249,136,125,164,125,125,241,249,249,249,181,64,226,249,249,249,249,249,249,249,249,249,241,136,73,220,249,241,201,139,135,104,139,162,249,249,226,89,123,241,241,249,249,249,249,249,249,241,125,249,249,249,249,249,249,249,249,249,249,249,249,249,220,135,45,2,0,0,0,11,45,78,127,156,174,191,197,201,198,191,169,147,118,66,33,3,0,0,0,19,64,164,241,241,249,249,242,249,241,249,241,249,241,249,241,249,123,249,241,241,241,241,249,241,249,232,73,132,232,249,241,125,123,66,123,123,249,241,232,118,97,241,249,249,249,249,249,249,249,249,249,249,249,249,197,70,104,196,164,162,162,132,125,135,197,118,66,191,241,249,249,249,249,249,249,249,241,249,123,249,249,249,249,249,249,249,249,249,249,249,241,241,162,232,249,220,169,100,38,13,3,0,0,0,0,0,0,0,0,0,0,0,0,0,5,15,54,125,190,234,249,136,201,194,194,201,206,213,206,201,206,218,197,213,201,197,194,196,206,197,226,206,201,249,201,206,218,173,64,123,196,125,125,73,135,125,194,118,66,181,241,241,249,249,249,249,249,249,241,232,241,232,241,232,241,232,196,118,52,45,64,66,38,47,114,194,232,241,241,232,241,232,241,232,241,232,241,232,132,232,241,232,241,241,232,241,232,241,232,241,232,241,135,226,232,241,241,234,241,220,201,181,146,115,89,71,64,64,64,74,97,125,156,191,211,232,241,241,241,234,234,124,181,173,187,183,181,191,169,181,173,181,194,181,201,194,181,181,181,181,196,183,191,206,181,181,196,232,232,194,118,64,45,57,47,66,123,196,232,241,241,241,232,241,232,241,249,};                        
        
uint8_t *image_p = image; //Sets pointer to first element in array
int currentLocation = 0;
int largeDataSize = 0;

int latPin = 4;
///////////////////////////////////

BLEServer *pServer = NULL;
BLECharacteristic * pTestChar_1;

bool deviceConnected = false;

class MyServerCallbacks: public BLEServerCallbacks {
  // TODO this doesn't take into account several clients being connected
    
    void onConnect(BLEServer* pServer) {
      BLEAdvertising *pAdvertising = BLEDevice::getAdvertising();
      pAdvertising->start();
      deviceConnected = true;
      Serial.println("I connected!");
    };
    
    void onDisconnect(BLEServer* pServer) {
      Serial.println("I Disconnected!");
      deviceConnected = false;
    }  
};


class MyCallbacks: public BLECharacteristicCallbacks {
    void onWrite(BLECharacteristic *pCharacteristic) {
      std::string uuid = pCharacteristic->getUUID().toString();
      std::string value = pCharacteristic->getValue();

      if (value.length() > 0) {
        Serial.println("*********");
        Serial.print("From UUID: ");
        Serial.println(uuid.c_str());
        for (int i = 0; i < value.length(); i++)
          Serial.print(value[i]);

        Serial.println();
        Serial.println("*********");
      }
    }

    void onRead(BLECharacteristic* pCharacteristic) {
      String uuid = pCharacteristic->getUUID().toString().c_str();
      Serial.print("Someone wants to read my data: ");
      Serial.println(uuid.c_str());
      BLEUUID hit = pCharacteristic->getUUID();
      BLEUUID BLETST = BLEUUID(TEST_CHAR_2);
      //Serial.println("Someone wants to read my data: ");

      if(hit.equals(BLETST))
      {
         String randNumber = String(random(300));
         String message = randNumber;
         Serial.print("Transmitting: ");
         Serial.println(message.c_str());
         pCharacteristic->setValue(message.c_str());
      }
      else
      {
        Serial.println("Unknown UUID!");  
      }
   }
};

void setup()
{
  Serial.begin(115200);                                                         // Initialize serial port
  Serial.println("Starting BLE work!");

  pinMode(latPin, OUTPUT);

  BLEDevice::init(payloadName.c_str());                                                      // Initialize the BLE device
  BLEDevice::setPower(ESP_PWR_LVL_N14);
  BLEServer *pServer = BLEDevice::createServer();                               // Save the BLE device server

  //Creating Services
  BLEService *pTestService = pServer->createService(TEST_SERVICE_UUID);                 // Create the service UUID from the server
  //BLEService *pBestService = pServer->createService(BEST_SERVICE_UUID);                 // Create the service UUID from the server
    
  //Creating Characteristics
  pTestChar_1 = pTestService->createCharacteristic(                                // Create the characteristic UUID for server
                                         BLEUUID(TEST_CHAR_3),
                                         BLECharacteristic::PROPERTY_READ  |
                                         BLECharacteristic::PROPERTY_WRITE |
                                         BLECharacteristic::PROPERTY_NOTIFY |
                                         BLECharacteristic::PROPERTY_INDICATE
                                       );

  /*pBestChar_1 = pBestService->createCharacteristic(                                // Create the characteristic UUID for server
                                         BEST_CHAR_1,
                                         BLECharacteristic::PROPERTY_READ  |
                                         BLECharacteristic::PROPERTY_WRITE |
                                         BLECharacteristic::PROPERTY_NOTIFY |
                                         BLECharacteristic::PROPERTY_INDICATE
                                       );
  */
  pTestChar_1->setCallbacks(new MyCallbacks()); 

  pTestChar_1->addDescriptor(new BLE2902());

  //pBestChar_1->setCallbacks(new MyCallbacks()); 

  //pBestChar_1->addDescriptor(new BLE2902());

  pTestService->start();                                                            // Start service

  //pBestService->start();   
  
  pServer->setCallbacks(new MyServerCallbacks());                               // Set server callbacks
  
  //Advertising
  BLEAdvertising *pAdvertising = BLEDevice::getAdvertising();                   // Grab advertisiing service
  pAdvertising->addServiceUUID(TEST_SERVICE_UUID);   
  // pAdvertising->addServiceUUID(BEST_SERVICE_UUID);  
  pAdvertising->setScanResponse(true);                                          
  pAdvertising->setMinPreferred(0x06);  // functions that help with iPhone connections issue
  pAdvertising->setMinPreferred(0x12);
  BLEDevice::startAdvertising();                                                // Start advertising
  Serial.println("Setup Complete. We are Advertising!");
}

void sendNotify(BLECharacteristic* chr, int notif = 0)
{
  if(notif != 0);
  {
    Serial.println("Setting Notify Value!");
    chr->setValue((uint32_t&)notif); 
  }
  chr->notify();
  Serial.println("Notification Sent");
} 

int isNotZero(int num)
{
  if(num == 0)
  {
    return 0;
  }
  return 1;
}

void sendLargeData(BLECharacteristic* chr, uint8_t *image_p, int len)
{
  Serial.println("Configuring Large Data");
  currentLocation = 0;
  largeDataSize = len;
  int totalTranmissions = (len/TRANSMISSION_SIZE) + isNotZero(len%TRANSMISSION_SIZE);
  Serial.print("Total Transmissions: ");
  Serial.println(totalTranmissions);
  sendNotify(chr, totalTranmissions);
}


void loop() {
  if (deviceConnected) {
     Serial.println("Wow, I am connected!");
     Serial.println("Sending Notification!");
     sendNotify(pTestChar_1);
  }
  else
  {
     Serial.print(BLEDevice::getAddress().toString().c_str());
     Serial.println(" Device is not Connected");
  }
  int randNumber = random(4,10);
  delay(randNumber*1000);
  delay((10-randNumber + 10)*1000);
}
